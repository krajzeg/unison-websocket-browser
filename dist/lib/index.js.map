{"version":3,"sources":["index.js"],"names":[],"mappings":"uwBAAA,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAE1B,IAAM,eAAe,GAAG;AACtB,OAAK,EAAE,KAAK,EACb,CAAC;;;AAEmB,qBAAqB;AAC7B,WADQ,qBAAqB,CAC5B,YAAY,EAAgB,KAAd,OAAO,yDAAG,EAAE,sCADnB,qBAAqB;AAEtC,QAAI,CAAC,SAAS;AACZ,UAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;;AAE/D,QAAI,CAAC,OAAO,GAAG,CAAC,CAAC,QAAQ,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AACpD,QAAI,CAAC,GAAG,GAAG,YAAY,CAAC;;AAExB,QAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;AAC5B,QAAI,CAAC,cAAc,GAAG,EAAE,CAAC;;AAEzB,QAAI,CAAC,OAAO,EAAE,CAAC,CAChB,aAZkB,qBAAqB;;;AAcjC,uBAAG;AACR,UAAI,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC3C,QAAE,CAAC,MAAM,GAAG,oBAAM,MAAK,oBAAoB,EAAE,EAAA,CAAC;AAC9C,QAAE,CAAC,OAAO,GAAG,YAAM;AACjB,eAAO,CAAC,GAAG,8BAA4B,MAAK,GAAG,cAAW,CAAC,CAC5D,CAAC;;AACF,QAAE,CAAC,SAAS,GAAG,UAAC,GAAG,EAAK,CAAE,MAAK,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA,CAAE,CAAC,CACpD;;;AAEG,kBAAC,SAAS,EAAE;AACd,UAAI,IAAI,CAAC,EAAE,CAAC,UAAU,GAAG,SAAS,CAAC,IAAI,EAAE;AACvC,YAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,iCAA+B,SAAS,OAAI,CAAC;AAChF,YAAI,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CACrC;AAAM;AACL,YAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,wBAAsB,SAAS,OAAI,CAAC;AACvE,YAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CACzB,CACF;;;;AAEmB,oCAAG;AACrB,UAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAC,GAAG,UAAK,OAAK,IAAI,CAAC,GAAG,CAAC,EAAA,CAAC,CAAC;AACrD,UAAI,CAAC,cAAc,GAAG,EAAE,CAAC,CAC1B;;;AAEM,qBAAC,SAAS,EAAE;AACjB,UAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,yBAAuB,SAAS,OAAI,CAAC;;AAExE,UAAI,IAAI,CAAC,gBAAgB,EAAE;AACzB,YAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,CAClC;AAAM;;AAEL,YAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,+DAA+D,CAAC;AACnG,YAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CACxC,CACF;;;;AAEQ,uBAAC,QAAQ,EAAE;AAClB,UAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;;;AAGjC,UAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,UAAC,GAAG,EAAK;AACtC,eAAK,OAAO,CAAC,GAAG,CAAC,CAAC,CACnB,CAAC,CAAC,CACJ,YAzDkB,qBAAqB,2BAArB,qBAAqB","file":"index.js","sourcesContent":["var _ = require('lodash');\n\nconst DEFAULT_OPTIONS = {\n  debug: false\n};\n\nexport default class UnisonWebsocketClient {\n  constructor(websocketUrl, options = {}) {\n    if (!WebSocket)\n      throw new Error(\"Your browser does not support websockets.\");\n\n    this.options = _.defaults(options, DEFAULT_OPTIONS);\n    this.url = websocketUrl;\n\n    this._bufferedReceives = [];\n    this._bufferedSends = [];\n\n    this.connect();\n  }\n\n  connect() {\n    let ws = this.ws = new WebSocket(this.url);\n    ws.onopen = () => this.sendBufferedMessages();\n    ws.onclose = () => {\n      console.log(`Websocket connection to ${this.url} closed.`);\n    };\n    ws.onmessage = (evt) => { this.receive(evt.data) };\n  }\n\n  send(msgString) {\n    if (this.ws.readyState < WebSocket.OPEN) {\n      if (this.options.debug) console.log(`[UNISON] Buffering a send: ${msgString}.`);\n      this._bufferedSends.push(msgString);\n    } else {\n      if (this.options.debug) console.log(`[UNISON] Sending: ${msgString}.`);\n      this.ws.send(msgString);\n    }\n  }\n\n  sendBufferedMessages() {\n    this._bufferedSends.forEach((msg) => this.send(msg));\n    this._bufferedSends = [];\n  }\n\n  receive(msgString) {\n    if (this.options.debug) console.log(`[UNISON] Received: ${msgString}.`);\n\n    if (this._receiveCallback) {\n      this._receiveCallback(msgString);\n    } else {\n      // if the callback is not registered yet, we buffer messages for later\n      if (this.options.debug) console.log(`[UNISON] Stashing received message, no callback registered.`);\n      this._bufferedReceives.push(msgString);\n    }\n  }\n\n  onReceive(callback) {\n    this._receiveCallback = callback;\n\n    // deliver all buffered messages now that there is somebody listening\n    this._bufferedReceives.forEach((msg) => {\n      this.receive(msg);\n    });\n  }\n}\n"],"sourceRoot":"../../lib"}