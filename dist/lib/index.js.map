{"version":3,"sources":["index.js"],"names":[],"mappings":"uwBAAA,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAE1B,IAAM,eAAe,GAAG;AACtB,OAAK,EAAE,KAAK,EACb,CAAC;;;AAEmB,qBAAqB;AAC7B,WADQ,qBAAqB,CAC5B,YAAY,EAAgB,KAAd,OAAO,yDAAG,EAAE,sCADnB,qBAAqB;AAEtC,QAAI,CAAC,SAAS;AACZ,UAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;;AAE/D,QAAI,CAAC,OAAO,GAAG,CAAC,CAAC,QAAQ,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AACpD,QAAI,CAAC,GAAG,GAAG,YAAY,CAAC;;AAExB,QAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;;AAE5B,QAAI,CAAC,OAAO,EAAE,CAAC,CAChB,aAXkB,qBAAqB;;;AAajC,uBAAG;AACR,UAAI,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC3C,QAAE,CAAC,OAAO,GAAG,YAAM;AACjB,eAAO,CAAC,GAAG,8BAA4B,MAAK,GAAG,cAAW,CAAC,CAC5D,CAAC;;AACF,QAAE,CAAC,SAAS,GAAG,UAAC,GAAG,EAAK,CAAE,MAAK,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA,CAAE,CAAC,CACpD;;;AAEG,kBAAC,SAAS,EAAE;AACd,UAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,wBAAsB,SAAS,OAAI,CAAC;AACvE,QAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CACpB;;;AAEM,qBAAC,SAAS,EAAE;AACjB,UAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,yBAAuB,SAAS,OAAI,CAAC;;AAExE,UAAI,IAAI,CAAC,gBAAgB,EAAE;AACzB,YAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,CAClC;AAAM;;AAEL,YAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,+DAA+D,CAAC;AACnG,YAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CACxC,CACF;;;;AAEQ,uBAAC,QAAQ,EAAE;AAClB,UAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;;;AAGjC,UAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,UAAC,GAAG,EAAK;AACtC,eAAK,OAAO,CAAC,GAAG,CAAC,CAAC,CACnB,CAAC,CAAC,CACJ,YA7CkB,qBAAqB,2BAArB,qBAAqB","file":"index.js","sourcesContent":["var _ = require('lodash');\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  debug: false\r\n};\r\n\r\nexport default class UnisonWebsocketClient {\r\n  constructor(websocketUrl, options = {}) {\r\n    if (!WebSocket)\r\n      throw new Error(\"Your browser does not support websockets.\");\r\n\r\n    this.options = _.defaults(options, DEFAULT_OPTIONS);\r\n    this.url = websocketUrl;\r\n\r\n    this._bufferedMessages = [];\r\n\r\n    this.connect();\r\n  }\r\n\r\n  connect() {\r\n    let ws = this.ws = new WebSocket(this.url);\r\n    ws.onclose = () => {\r\n      console.log(`Websocket connection to ${this.url} closed.`);\r\n    };\r\n    ws.onmessage = (evt) => { this.receive(evt.data) };\r\n  }\r\n\r\n  send(msgString) {\r\n    if (this.options.debug) console.log(`[UNISON] Sending: ${msgString}.`);\r\n    ws.send(msgString);\r\n  }\r\n\r\n  receive(msgString) {\r\n    if (this.options.debug) console.log(`[UNISON] Received: ${msgString}.`);\r\n\r\n    if (this._receiveCallback) {\r\n      this._receiveCallback(msgString);\r\n    } else {\r\n      // if the callback is not registered yet, we buffer messages for later\r\n      if (this.options.debug) console.log(`[UNISON] Stashing received message, no callback registered.`);\r\n      this._bufferedMessages.push(msgString);\r\n    }\r\n  }\r\n\r\n  onReceive(callback) {\r\n    this._receiveCallback = callback;\r\n\r\n    // deliver all buffered messages now that there is somebody listening\r\n    this._bufferedMessages.forEach((msg) => {\r\n      this.receive(msg);\r\n    });\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\lib"}